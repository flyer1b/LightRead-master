/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => SyncReadPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");
var DEFAULT_SETTINGS = {
  email: "",
  password: "",
  token: "",
  time: "2020-01-01 00:00:00",
  apiKey: ""
};
var isWriting = false;
var SyncReadPlugin = class extends import_obsidian.Plugin {
  async onload() {
    await this.loadSettings();
    const ribbonIconEl = this.addRibbonIcon("sync", "SyncRead", (evt) => {
      writeAllArticles(this.app, this);
    });
    this.addSettingTab(new SyncReadSettingTab(this.app, this));
  }
  onunload() {
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
};
var SyncReadSettingTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    new import_obsidian.Setting(containerEl).setName("\u7528\u6237\u540D").setDesc("\u8F93\u5165\u4F60\u5728SyncRead\u6CE8\u518C\u7684\u90AE\u7BB1").addText((text) => text.setPlaceholder("\u8BF7\u8F93\u5165\u90AE\u7BB1").setValue(this.plugin.settings.email).onChange(async (value) => {
      this.plugin.settings.email = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("\u5BC6\u7801").setDesc("").addText((text) => text.setPlaceholder("\u8BF7\u8F93\u5165\u5BC6\u7801").setValue(this.plugin.settings.password).onChange(async (value) => {
      this.plugin.settings.password = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).addButton((button) => {
      button.setButtonText("\u767B\u5F55").onClick(async () => {
        button.disabled = true;
        button.setButtonText("\u767B\u5F55\u4E2D...");
        const { email, password } = this.plugin.settings;
        try {
          const res = await (0, import_obsidian.requestUrl)({
            url: "http://43.138.149.38:5050/login/",
            method: "POST",
            contentType: "application/json",
            body: JSON.stringify({
              "username": email,
              "password": password
            })
          });
          if (res.status !== 200) {
            new import_obsidian.Notice("\u767B\u5F55\u5931\u8D25");
            button.disabled = false;
            button.setButtonText("\u767B\u5F55");
            return;
          }
          const data = await res.json;
          this.plugin.settings.token = data.data.token;
          await this.plugin.saveSettings();
          new import_obsidian.Notice("\u767B\u5F55\u6210\u529F");
          button.setButtonText("\u767B\u5F55\u6210\u529F");
          button.disabled = false;
        } catch (error) {
          new import_obsidian.Notice("\u767B\u5F55\u5931\u8D25: " + error.message);
          button.disabled = false;
          button.setButtonText("\u767B\u5F55");
          return;
        }
      });
    });
    new import_obsidian.Setting(containerEl).setName("api key(\u53EF\u9009)").addText((text) => text.setPlaceholder("\u8BF7\u8F93\u5165api key").setValue(this.plugin.settings.apiKey).onChange(async (value) => {
      this.plugin.settings.apiKey = value;
      await this.plugin.saveSettings();
    }));
  }
};
async function fetchArticle(settings, time, page) {
  try {
    const apiKey = settings.apiKey;
    let res;
    if (apiKey === "") {
      res = await (0, import_obsidian.requestUrl)(
        {
          url: `http://43.138.149.38:5050/get_synced_articles?time=${time}&page_number=${page}&page_size=50`,
          method: "GET",
          headers: {
            "Authorization": "Bearer " + settings.token
          }
        }
      );
    } else {
      res = await (0, import_obsidian.requestUrl)(
        {
          url: `http://43.138.149.38:5050/get_synced_articles_by_key?time=${time}&page_number=${page}&page_size=50`,
          method: "GET",
          headers: {
            "api_key": apiKey
          }
        }
      );
    }
    if (res.status !== 200) {
      new import_obsidian.Notice("\u540C\u6B65\u5931\u8D25");
      isWriting = false;
      return;
    }
    const data = await res.json;
    return data.data;
  } catch (error) {
    new import_obsidian.Notice("\u540C\u6B65\u5931\u8D25: " + error.message);
    isWriting = false;
    return;
  }
}
async function writeArticle(vault, fileManager, article) {
  var folder = vault.getAbstractFileByPath("SyncRead\u540C\u6B65\u6587\u4EF6\u5939");
  if (!folder)
    folder = await vault.createFolder("SyncRead\u540C\u6B65\u6587\u4EF6\u5939");
  new import_obsidian.Notice("url: " + article.site);
  let file = await vault.create(folder.path + "/" + filterIllegalChars((0, import_obsidian.normalizePath)(article.title)) + ".md", article.content);
  return fileManager.processFrontMatter(file, (frontMatter) => {
    frontMatter["created_at"] = new Date().toISOString();
    frontMatter["url"] = article.site;
  });
}
async function writeAllArticles(app, plugin) {
  let vault = app.vault;
  let fileManager = app.fileManager;
  new import_obsidian.Notice(isWriting ? "\u6B63\u5728\u540C\u6B65" : "\u5F00\u59CB\u540C\u6B65");
  if (isWriting)
    return;
  isWriting = true;
  var time = plugin.settings.time;
  var page = 1;
  do {
    const articles = await fetchArticle(plugin.settings, time, page);
    if (articles.length === 0) {
      isWriting = false;
      new import_obsidian.Notice("\u540C\u6B65\u5B8C\u6210");
      break;
    }
    try {
      await Promise.all(articles.map((article) => writeArticle(vault, fileManager, article)));
    } catch (error) {
    }
    plugin.settings.time = articles[articles.length - 1].created_at;
    plugin.saveSettings();
    page++;
    await new Promise((resolve) => setTimeout(resolve, 1e3));
  } while (true);
}
function filterIllegalChars(title) {
  const illegalChars = /[\\/:*?"<>|]/g;
  const filteredTitle = title.replace(illegalChars, "");
  return filteredTitle;
}
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgdGltZSB9IGZyb20gJ2NvbnNvbGUnO1xuaW1wb3J0IHsgQXBwLCBOb3RpY2UsIFBsdWdpbiwgUGx1Z2luU2V0dGluZ1RhYiwgU2V0dGluZyxWYXVsdCxURmlsZSwgbm9ybWFsaXplUGF0aCwgcmVxdWVzdFVybCwgRmlsZU1hbmFnZXIgfSBmcm9tICdvYnNpZGlhbic7XG5cbi8vIFJlbWVtYmVyIHRvIHJlbmFtZSB0aGVzZSBjbGFzc2VzIGFuZCBpbnRlcmZhY2VzIVxuXG5pbnRlcmZhY2UgU3luY1JlYWRQbHVnaW5TZXR0aW5ncyB7XG5cdGVtYWlsOiBzdHJpbmc7XG5cdHBhc3N3b3JkOiBzdHJpbmc7XG5cdHRva2VuOiBzdHJpbmc7XG5cdHRpbWU6IHN0cmluZztcblx0YXBpS2V5OiBzdHJpbmc7XG59XG5cbmNvbnN0IERFRkFVTFRfU0VUVElOR1M6IFN5bmNSZWFkUGx1Z2luU2V0dGluZ3MgPSB7XG5cdGVtYWlsOiAnJyxcblx0cGFzc3dvcmQ6ICcnLFxuXHR0b2tlbjogJycsXG5cdHRpbWU6ICcyMDIwLTAxLTAxIDAwOjAwOjAwJyxcblx0YXBpS2V5OiAnJ1xufVxuXG52YXIgaXNXcml0aW5nID0gZmFsc2U7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFN5bmNSZWFkUGx1Z2luIGV4dGVuZHMgUGx1Z2luIHtcblx0c2V0dGluZ3M6IFN5bmNSZWFkUGx1Z2luU2V0dGluZ3M7XG5cblx0YXN5bmMgb25sb2FkKCkge1xuXHRcdGF3YWl0IHRoaXMubG9hZFNldHRpbmdzKCk7XG5cblx0XHQvLyBUaGlzIGNyZWF0ZXMgYW4gaWNvbiBpbiB0aGUgbGVmdCByaWJib24uXG5cdFx0Y29uc3QgcmliYm9uSWNvbkVsID0gdGhpcy5hZGRSaWJib25JY29uKCdzeW5jJywgJ1N5bmNSZWFkJywgKGV2dDogTW91c2VFdmVudCkgPT4ge1xuXHRcdFx0Ly8gQ2FsbGVkIHdoZW4gdGhlIHVzZXIgY2xpY2tzIHRoZSBpY29uLlxuXHRcdFx0Ly8gbmV3IE5vdGljZSgnVGhpcyBpcyBhIG5vdGljZSEnKTtcblx0XHRcdC8vIG5ldyBOb3RpY2UoYHBhdGg6ICR7dGhpcy5hcHAudmF1bHQuZ2V0Um9vdCgpLnBhdGh9YCk7XG5cdFx0XHQvLyBjcmFldGVGaWxlKHRoaXMuYXBwLnZhdWx0KTtcblx0XHRcdC8vIG5ldyBOb3RpY2UoYHRva2VuOiAke3RoaXMuc2V0dGluZ3MudG9rZW59YCk7XG5cdFx0IFx0d3JpdGVBbGxBcnRpY2xlcyh0aGlzLmFwcCx0aGlzKTtcblx0XHR9KTtcblx0XHRcblxuXHRcdC8vIFRoaXMgYWRkcyBhIHNldHRpbmdzIHRhYiBzbyB0aGUgdXNlciBjYW4gY29uZmlndXJlIHZhcmlvdXMgYXNwZWN0cyBvZiB0aGUgcGx1Z2luXG5cdFx0Ly8gaWYodGhpcy5zZXR0aW5ncy50b2tlbiAhPT0gJycpe1xuXHRcdC8vIFx0dGhpcy5hZGRTZXR0aW5nVGFiKG5ldyBTZXR0aW5nc1RhYih0aGlzLmFwcCwgdGhpcykpO1xuXHRcdC8vIH1lbHNle1xuXHRcdC8vIH1cblx0XHR0aGlzLmFkZFNldHRpbmdUYWIobmV3IFN5bmNSZWFkU2V0dGluZ1RhYih0aGlzLmFwcCwgdGhpcykpO1xuXG5cdH1cblxuXHRvbnVubG9hZCgpIHtcblx0fVxuXG5cdGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcblx0XHR0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgYXdhaXQgdGhpcy5sb2FkRGF0YSgpKTtcblx0XHQvLyB0aGlzLnNldHRpbmdzLnRpbWUgPSAnMjAyMC0wMS0wMSAwMDowMDowMCc7XG5cdH1cblxuXHRhc3luYyBzYXZlU2V0dGluZ3MoKSB7XG5cdFx0YXdhaXQgdGhpcy5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcblx0fVxufVxuXG5cbmNsYXNzIFN5bmNSZWFkU2V0dGluZ1RhYiBleHRlbmRzIFBsdWdpblNldHRpbmdUYWIge1xuXHRwbHVnaW46IFN5bmNSZWFkUGx1Z2luO1xuXG5cdGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IFN5bmNSZWFkUGx1Z2luKSB7XG5cdFx0c3VwZXIoYXBwLCBwbHVnaW4pO1xuXHRcdHRoaXMucGx1Z2luID0gcGx1Z2luO1xuXHRcdFxuXHR9XG5cblx0ZGlzcGxheSgpOiB2b2lkIHtcblx0XHRjb25zdCB7Y29udGFpbmVyRWx9ID0gdGhpcztcblxuXHRcdGNvbnRhaW5lckVsLmVtcHR5KCk7XG5cblx0XHRuZXcgU2V0dGluZyhjb250YWluZXJFbClcblx0XHRcdC5zZXROYW1lKCdcdTc1MjhcdTYyMzdcdTU0MEQnKVxuXHRcdFx0LnNldERlc2MoJ1x1OEY5M1x1NTE2NVx1NEY2MFx1NTcyOFN5bmNSZWFkXHU2Q0U4XHU1MThDXHU3Njg0XHU5MEFFXHU3QkIxJylcblx0XHRcdC5hZGRUZXh0KHRleHQgPT4gdGV4dFxuXHRcdFx0XHQuc2V0UGxhY2Vob2xkZXIoJ1x1OEJGN1x1OEY5M1x1NTE2NVx1OTBBRVx1N0JCMScpXG5cdFx0XHRcdC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbWFpbClcblx0XHRcdFx0Lm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuXHRcdFx0XHRcdHRoaXMucGx1Z2luLnNldHRpbmdzLmVtYWlsID0gdmFsdWU7XG5cdFx0XHRcdFx0YXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG5cdFx0XHRcdH0pKTtcblx0XHRuZXcgU2V0dGluZyhjb250YWluZXJFbClcblx0XHRcdC5zZXROYW1lKCdcdTVCQzZcdTc4MDEnKVxuXHRcdFx0LnNldERlc2MoJycpXG5cdFx0XHQuYWRkVGV4dCh0ZXh0ID0+IHRleHRcblx0XHRcdFx0LnNldFBsYWNlaG9sZGVyKCdcdThCRjdcdThGOTNcdTUxNjVcdTVCQzZcdTc4MDEnKVxuXHRcdFx0XHQuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MucGFzc3dvcmQpXG5cdFx0XHRcdC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcblx0XHRcdFx0XHR0aGlzLnBsdWdpbi5zZXR0aW5ncy5wYXNzd29yZCA9IHZhbHVlO1xuXHRcdFx0XHRcdGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuXHRcdFx0XHR9KSk7XG5cdFx0bmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG5cdFx0XHQuYWRkQnV0dG9uKGJ1dHRvbiA9PiB7XG5cdFx0XHRcdGJ1dHRvblxuXHRcdFx0XHRcdC5zZXRCdXR0b25UZXh0KCdcdTc2N0JcdTVGNTUnKVxuXHRcdFx0XHRcdC5vbkNsaWNrKGFzeW5jICgpID0+IHtcblx0XHRcdFx0XHRcdGJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG5cdFx0XHRcdFx0XHRidXR0b24uc2V0QnV0dG9uVGV4dCgnXHU3NjdCXHU1RjU1XHU0RTJELi4uJyk7XG5cdFx0XHRcdFx0XHRjb25zdCB7ZW1haWwsIHBhc3N3b3JkfSA9IHRoaXMucGx1Z2luLnNldHRpbmdzO1xuXHRcdFx0XHRcdFx0Ly8gbmV3IE5vdGljZShgZW1haWw6ICR7ZW1haWx9YCk7XG5cdFx0XHRcdFx0XHR0cnl7XG5cdFx0XHRcdFx0XHRjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0VXJsKHtcblx0XHRcdFx0XHRcdFx0dXJsOidodHRwOi8vNDMuMTM4LjE0OS4zODo1MDUwL2xvZ2luLycsXG5cdFx0XHRcdFx0XHRcdG1ldGhvZDogJ1BPU1QnLFxuXHRcdFx0XHRcdFx0XHRjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLFxuXHRcdFx0XHRcdFx0XHRib2R5OiBKU09OLnN0cmluZ2lmeSh7XG5cdFx0XHRcdFx0XHRcdFx0XHQndXNlcm5hbWUnOmVtYWlsLFxuXHRcdFx0XHRcdFx0XHRcdFx0J3Bhc3N3b3JkJzpwYXNzd29yZFxuXHRcdFx0XHRcdFx0XHRcblx0XHRcdFx0XHRcdH0pfSk7XG5cdFx0XHRcdFx0XHRpZiAocmVzLnN0YXR1cyAhPT0gMjAwKSB7XG5cdFx0XHRcdFx0XHRcdG5ldyBOb3RpY2UoJ1x1NzY3Qlx1NUY1NVx1NTkzMVx1OEQyNScpO1xuXHRcdFx0XHRcdFx0XHRidXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcblx0XHRcdFx0XHRcdFx0YnV0dG9uLnNldEJ1dHRvblRleHQoJ1x1NzY3Qlx1NUY1NScpO1xuXHRcdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRjb25zdCBkYXRhID0gYXdhaXQgcmVzLmpzb247XG5cdFx0XHRcdFx0XHQvLyBuZXcgTm90aWNlKGByZXM6ICR7SlNPTi5zdHJpbmdpZnkoZGF0YSl9YCk7XG5cdFx0XHRcdFx0XHR0aGlzLnBsdWdpbi5zZXR0aW5ncy50b2tlbiA9IGRhdGEuZGF0YS50b2tlbjtcblx0XHRcdFx0XHRcdGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuXHRcdFx0XHRcdFx0bmV3IE5vdGljZSgnXHU3NjdCXHU1RjU1XHU2MjEwXHU1MjlGJyk7XG5cdFx0XHRcdFx0XHRidXR0b24uc2V0QnV0dG9uVGV4dCgnXHU3NjdCXHU1RjU1XHU2MjEwXHU1MjlGJyk7XG5cdFx0XHRcdFx0XHRidXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcblx0XHRcdFx0XHR9Y2F0Y2goZXJyb3Ipe1xuXHRcdFx0XHRcdFx0bmV3IE5vdGljZSgnXHU3NjdCXHU1RjU1XHU1OTMxXHU4RDI1OiAnICsgZXJyb3IubWVzc2FnZSk7XG5cdFx0XHRcdFx0XHRidXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcblx0XHRcdFx0XHRcdGJ1dHRvbi5zZXRCdXR0b25UZXh0KCdcdTc2N0JcdTVGNTUnKTtcblx0XHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHR9KVxuXG5cdFx0bmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG5cdFx0XHQuc2V0TmFtZSgnYXBpIGtleShcdTUzRUZcdTkwMDkpJylcblx0XHRcdC5hZGRUZXh0KHRleHQgPT4gdGV4dFxuXHRcdFx0XHQuc2V0UGxhY2Vob2xkZXIoJ1x1OEJGN1x1OEY5M1x1NTE2NWFwaSBrZXknKVxuXHRcdFx0XHQuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuYXBpS2V5KVxuXHRcdFx0XHQub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0dGhpcy5wbHVnaW4uc2V0dGluZ3MuYXBpS2V5ID0gdmFsdWU7XG5cdFx0XHRcdFx0YXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG5cdFx0XHRcdH0pKTtcblx0fVxufVxuXG5cbmFzeW5jIGZ1bmN0aW9uIGZldGNoQXJ0aWNsZShzZXR0aW5nczogU3luY1JlYWRQbHVnaW5TZXR0aW5ncyx0aW1lOiBzdHJpbmcscGFnZTogbnVtYmVyKXtcblxuXHR0cnkge1xuXG5cdGNvbnN0IGFwaUtleSA9IHNldHRpbmdzLmFwaUtleTtcblx0bGV0IHJlcztcblx0aWYoYXBpS2V5ID09PSAnJyl7XG5cdFx0cmVzID0gYXdhaXQgcmVxdWVzdFVybChcblx0XHR7XG5cdFx0XHR1cmw6YGh0dHA6Ly80My4xMzguMTQ5LjM4OjUwNTAvZ2V0X3N5bmNlZF9hcnRpY2xlcz90aW1lPSR7dGltZX0mcGFnZV9udW1iZXI9JHtwYWdlfSZwYWdlX3NpemU9NTBgLCBcblx0XHRcdG1ldGhvZDogJ0dFVCcsXG5cdFx0XHRoZWFkZXJzOiB7XG5cdFx0XHRcdCdBdXRob3JpemF0aW9uJzogJ0JlYXJlciAnICsgc2V0dGluZ3MudG9rZW5cblx0XHRcdH0sXG5cdFx0fVxuXHRcdCk7XG5cdH1lbHNle1xuXHRcdHJlcyA9IGF3YWl0IHJlcXVlc3RVcmwoXG5cdFx0XHR7XG5cdFx0XHRcdHVybDpgaHR0cDovLzQzLjEzOC4xNDkuMzg6NTA1MC9nZXRfc3luY2VkX2FydGljbGVzX2J5X2tleT90aW1lPSR7dGltZX0mcGFnZV9udW1iZXI9JHtwYWdlfSZwYWdlX3NpemU9NTBgLCBcblx0XHRcdFx0bWV0aG9kOiAnR0VUJyxcblx0XHRcdFx0aGVhZGVyczoge1xuXHRcdFx0XHRcdCdhcGlfa2V5JzogIGFwaUtleVxuXHRcdFx0XHR9LFxuXHRcdFx0fVxuXHRcdFx0KTtcblx0fVxuXHQvLyBuZXcgTm90aWNlKGB0b2tlbjogJHtzZXR0aW5ncy50b2tlbn1gKTtcblx0aWYgKHJlcy5zdGF0dXMgIT09IDIwMCkge1xuXHRcdG5ldyBOb3RpY2UoJ1x1NTQwQ1x1NkI2NVx1NTkzMVx1OEQyNScpO1xuXHRcdGlzV3JpdGluZyA9IGZhbHNlO1xuXHRcdHJldHVybjtcblx0fVxuXHRjb25zdCBkYXRhID0gYXdhaXQgcmVzLmpzb247XG5cdC8vIG5ldyBOb3RpY2UoYHJlczogJHtkYXRhLmRhdGEubGVuZ3RofWApO1xuXHRyZXR1cm4gZGF0YS5kYXRhO1xufSBjYXRjaCAoZXJyb3IpIHtcblx0bmV3IE5vdGljZSgnXHU1NDBDXHU2QjY1XHU1OTMxXHU4RDI1OiAnICsgZXJyb3IubWVzc2FnZSk7XG5cdGlzV3JpdGluZyA9IGZhbHNlO1xuXHRyZXR1cm47XG59XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHdyaXRlQXJ0aWNsZSh2YXVsdDogVmF1bHQsZmlsZU1hbmFnZXI6RmlsZU1hbmFnZXIsIGFydGljbGU6IHsgdGl0bGU6IHN0cmluZywgY29udGVudDogc3RyaW5nICxzaXRlOnN0cmluZ30pOiBQcm9taXNlPHZvaWQ+IHtcblx0dmFyIGZvbGRlciA9IHZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aCgnU3luY1JlYWRcdTU0MENcdTZCNjVcdTY1ODdcdTRFRjZcdTU5MzknKTtcblx0aWYoIWZvbGRlcikgZm9sZGVyID0gYXdhaXQgdmF1bHQuY3JlYXRlRm9sZGVyKCdTeW5jUmVhZFx1NTQwQ1x1NkI2NVx1NjU4N1x1NEVGNlx1NTkzOScpO1xuXHRuZXcgTm90aWNlKCd1cmw6ICcgKyBhcnRpY2xlLnNpdGUpO1xuXHRsZXQgZmlsZSA9IGF3YWl0IHZhdWx0LmNyZWF0ZShmb2xkZXIucGF0aCsnLycrZmlsdGVySWxsZWdhbENoYXJzKG5vcm1hbGl6ZVBhdGgoYXJ0aWNsZS50aXRsZSkpICsgXCIubWRcIiwgYXJ0aWNsZS5jb250ZW50KTtcblx0cmV0dXJuIGZpbGVNYW5hZ2VyLnByb2Nlc3NGcm9udE1hdHRlcihmaWxlLChmcm9udE1hdHRlcikgPT4ge1xuXHRcdGZyb250TWF0dGVyWydjcmVhdGVkX2F0J10gPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG5cdFx0ZnJvbnRNYXR0ZXJbJ3VybCddID0gYXJ0aWNsZS5zaXRlO1xuXHR9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gd3JpdGVBbGxBcnRpY2xlcyhhcHA6IEFwcCxwbHVnaW46IFN5bmNSZWFkUGx1Z2luKXtcblxuXHRsZXQgdmF1bHQgPSBhcHAudmF1bHQ7XG5cdGxldCBmaWxlTWFuYWdlciA9IGFwcC5maWxlTWFuYWdlcjtcblx0bmV3IE5vdGljZShpc1dyaXRpbmcgPyAnXHU2QjYzXHU1NzI4XHU1NDBDXHU2QjY1JyA6ICdcdTVGMDBcdTU5Q0JcdTU0MENcdTZCNjUnKTtcblx0aWYoaXNXcml0aW5nKSByZXR1cm47XG5cdFx0aXNXcml0aW5nID0gdHJ1ZTtcblx0dmFyIHRpbWUgPSBwbHVnaW4uc2V0dGluZ3MudGltZTtcblx0dmFyIHBhZ2UgPSAxO1xuXHQvLyBuZXcgTm90aWNlKGB0aW1lOiAke3RpbWV9YCk7XG5cdGRve1xuXHRcdFxuXHRcdGNvbnN0IGFydGljbGVzID0gYXdhaXQgZmV0Y2hBcnRpY2xlKHBsdWdpbi5zZXR0aW5ncyx0aW1lLHBhZ2UpO1xuXHRcdGlmIChhcnRpY2xlcy5sZW5ndGggPT09IDApIHtcblx0XHRcdGlzV3JpdGluZyA9IGZhbHNlO1xuXHRcdFx0bmV3IE5vdGljZSgnXHU1NDBDXHU2QjY1XHU1QjhDXHU2MjEwJyk7XG5cdFx0XHRicmVhaztcdFxuXHRcdH1cblx0XHR0cnl7XG5cdFx0XHRhd2FpdCBQcm9taXNlLmFsbChhcnRpY2xlcy5tYXAoKGFydGljbGU6IHsgdGl0bGU6IHN0cmluZzsgY29udGVudDogc3RyaW5nO3NpdGU6c3RyaW5nIH0pID0+IHdyaXRlQXJ0aWNsZSh2YXVsdCwgZmlsZU1hbmFnZXIsYXJ0aWNsZSkpKTtcblx0XHR9Y2F0Y2goZXJyb3Ipe1xuXHRcdFx0Ly8gbmV3IE5vdGljZShlcnJvci5tZXNzYWdlKTtcblx0XHRcdC8vIGlzV3JpdGluZyA9IGZhbHNlO1xuXHRcdFx0Ly8gcmV0dXJuO1xuXHRcdH1cblx0XHQvLyBuZXcgTm90aWNlKGBwYWdlOiAke3BhZ2V9YCk7XG5cdFx0cGx1Z2luLnNldHRpbmdzLnRpbWUgPSBhcnRpY2xlc1thcnRpY2xlcy5sZW5ndGgtMV0uY3JlYXRlZF9hdDtcblx0XHRwbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG5cdFx0cGFnZSsrO1xuXHRcdGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMDApKTtcblx0XHQvLyBuZXcgTm90aWNlKGBwYWdlOiAke3BhZ2V9YCk7XG5cdH13aGlsZSh0cnVlKTtcblxufVxuXG5mdW5jdGlvbiBmaWx0ZXJJbGxlZ2FsQ2hhcnModGl0bGU6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgLy8gXHU1QjlBXHU0RTQ5XHU5NzVFXHU2Q0Q1XHU1QjU3XHU3QjI2XG4gICAgY29uc3QgaWxsZWdhbENoYXJzID0gL1tcXFxcLzoqP1wiPD58XS9nO1xuICAgIC8vIFx1NEY3Rlx1NzUyOFx1NkI2M1x1NTIxOVx1ODg2OFx1OEZCRVx1NUYwRlx1NjZGRlx1NjM2Mlx1OTc1RVx1NkNENVx1NUI1N1x1N0IyNlxuICAgIGNvbnN0IGZpbHRlcmVkVGl0bGUgPSB0aXRsZS5yZXBsYWNlKGlsbGVnYWxDaGFycywgXCJcIik7XG4gICAgcmV0dXJuIGZpbHRlcmVkVGl0bGU7XG59Il0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBLHNCQUFtSDtBQVluSCxJQUFNLG1CQUEyQztBQUFBLEVBQ2hELE9BQU87QUFBQSxFQUNQLFVBQVU7QUFBQSxFQUNWLE9BQU87QUFBQSxFQUNQLE1BQU07QUFBQSxFQUNOLFFBQVE7QUFDVDtBQUVBLElBQUksWUFBWTtBQUVoQixJQUFxQixpQkFBckIs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
